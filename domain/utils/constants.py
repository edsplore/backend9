testInputScript = [
    {
    "role": "Trainee",
    "script_sentence": "Thank you for calling Sunshine Pharmacy. My name is Sarah, and I’m here to assist you with your prescription needs. This call may be recorded for quality and training purposes. Before we proceed, may I have your full name, please?",
    "keywords": [
        {
        "text": "Sunshine Pharmacy",
        "selectionIndex": "0",
        "selectionLength": "0"
        },
        {
        "text": "prescription",
        "selectionIndex": "0",
        "selectionLength": "0"
        },
        {
        "text": "quality",
        "selectionIndex": "0",
        "selectionLength": "0"
        },
        {
        "text": "training purposes",
        "selectionIndex": "0",
        "selectionLength": "0"
        },
        {
        "text": "full name",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "customer",
    "script_sentence": "<p>Hi, Sarah. This is Emily Johnson.</p>",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "Trainee",
    "script_sentence": "Thank you, Ms. Johnson. To ensure the privacy and security of your health information in accordance with HIPAA regulations, I need to verify your identity. Can you please provide your date of birth and the phone number associated with your pharmacy account?",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "customer",
    "script_sentence": "<p>My date of birth is April 15, 1985, and my phone number is 555-123-4567.</p>",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "Trainee",
    "script_sentence": "Thank you. Let me verify that information. Your information matches our records. How may I assist you with your prescription today?",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "customer",
    "script_sentence": "<p>I need to check the status of a prescription and see if I can get it refilled.</p>",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "Trainee",
    "script_sentence": "I’d be happy to help with that. Can you please provide the prescription number, or if you don’t have it, the name of the medication and the prescribing physician?",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "customer",
    "script_sentence": "<p>I don’t have the prescription number, but the medication is Lisinopril, 10 mg, and it was prescribed by Dr. Michael Carter.</p>",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "Trainee",
    "script_sentence": "Thank you, Ms. Johnson. Let me look up that prescription. I’ve found your prescription for Lisinopril, 10 mg, prescribed by Dr. Michael Carter. It looks like you have one refill remaining, and the prescription is eligible for fulfillment. Would you like me to process the refill for you today?",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "customer",
    "script_sentence": "<p>Yes, please. Can you tell me when it will be ready?</p>",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "Trainee",
    "script_sentence": "Certainly. I’m processing the refill now. It should be ready for pickup at Sunshine Pharmacy by 3",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "customer",
    "script_sentence": "<p>I’d like delivery, please.</p>",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "Trainee",
    "script_sentence": "Great. Let me confirm your delivery address. Our records show your address as 123 Maple Street, Apartment 4B, Springfield, IL 62701. Is that correct?",
    "keywords": [
        {
        "text": "delivery",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "customer",
    "script_sentence": "<p>Yes, that’s correct.</p>",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "Trainee",
    "script_sentence": "Perfect. The medication will be delivered to that address by tomorrow afternoon. You’ll receive a confirmation call or text when it’s on its way. The cost for the Lisinopril refill is $15. Would you like to use the card on file ending in 1234, or would you prefer another payment method?",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "customer",
    "script_sentence": "<p>The card on file is fine.</p>",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "Trainee",
    "script_sentence": "Thank you. I’ve processed the payment, and the refill order is confirmed. Before we conclude, I need to provide a few important reminders",
    "keywords": [
        {
        "text": "refill order",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "customer",
    "script_sentence": "<p>No, that’s all. Thank you, Sarah.</p>",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "Trainee",
    "script_sentence": "You’re very welcome, Ms. Johnson. Thank you for choosing Sunshine Pharmacy. Have a great day!",
    "keywords": [
        {
        "text": "Sunshine Pharmacy",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    },
    {
    "role": "customer",
    "script_sentence": "<p>You too. Goodbye.</p>",
    "keywords": [
        {
        "text": "",
        "selectionIndex": "0",
        "selectionLength": "0"
        }
    ]
    }
]

testTranscript = (
    "Trainee: Thank you for calling Sunshine Pharmacy. My name is Sarah, and I’m here to assist you with your prescription needs. This call may be recorded for quality and training purposes. Before we proceed, may I have your full name?\n"
    "Customer: Hi, Sarah. This is Emily Johnson.\n"
    "Trainee: Thank you, Ms. Johnson. To ensure the privacy and security of your health information in accordance with HIPAA regulations, I need to verify your identity. Can you please provide your date of birth and the phone number associated with your pharmacy account?\n"
    "Customer: My date of birth is April 15, 1985, and my phone number is 555-123-4567.\n"
    "Trainee: Thank you. Let me verify that information. Your information matches our records. How may I assist you with your prescription today?\n"
    "Customer: I need to check the status of a prescription and see if I can get it refilled.\n"
    "Trainee: I’d be happy to help with that. Can you please provide the prescription number, or if you don’t have it, the name of the medication and the prescribing physician?\n"
    "Customer: I don’t have the prescription number, but the medication is Lisinopril, 10 mg, and it was prescribed by Dr. Michael Carter.\n"
    "Trainee: Thank you, Ms. Johnson. Let me look up that prescription. I’ve found your prescription for Lisinopril, 10 mg, prescribed by Dr. Michael Carter. It looks like you have one refill remaining, and the prescription is eligible for fulfillment. Would you like me to process the refill for you today?\n"
    "Customer: Yes, please. Can you tell me when it will be ready?\n"
    "Trainee: Certainly. I’m processing the refill now. It should be ready for pickup at Sunshine Pharmacy by 3\n"
    "Customer: I’d like delivery, please.\n"
    "Trainee: Great. Let me confirm your delivery address. Our records show your address as 123 Maple Street, Apartment 4B, Springfield, IL 62701. Is that correct?\n"
    "Customer: Yes, that’s correct.\n"
    "Trainee: Perfect. The medication will be delivered to that address by tomorrow afternoon. You’ll receive a confirmation call or text when it’s on its way. The cost for the Lisinopril refill is $15. Would you like to use the card on file ending in 1234, or would you prefer another payment method?\n"
    "Customer: The card on file is fine.\n"
    "Trainee: Thank you. I’ve processed the payment, and the refill order is confirmed.\n"
    "Customer: No, that’s all. Thank you, Sarah.\n"
    "Trainee: You’re very welcome, Ms. Johnson. Thank you for choosing Sunshine Pharmacy. Have a great day!\n"
    "Customer: You too. Goodbye."
)

testTranscript1 = (
    "Trainee: Welcome to Sunshine Pharmacy. My name is Sarah, and I’m here to support you with any prescription-related concerns. This call might be recorded for quality assurance. May I please begin by getting your full name?\n"
    "Customer: Hi Sarah, I’m Emily Johnson.\n"
    "Trainee: Thank you, Ms. Johnson. In line with HIPAA standards, I need to confirm your identity to protect your private health data. Could you share your date of birth and the phone number linked to your pharmacy account?\n"
    "Customer: My birthday is April 15, 1985, and my number is 555-123-4567.\n"
    "Trainee: Thanks for that. I’ll go ahead and verify the details. Everything matches our system. How can I help you with your prescription today?\n"
    "Customer: I want to check the status of a prescription and see if I’m able to refill it.\n"
    "Trainee: Absolutely, I can assist with that. Could you give me the prescription number, or if that’s not available, the name of the medication and the prescribing doctor?\n"
    "Customer: I don’t have the prescription number handy. It’s for Lisinopril, 10 mg, and the doctor is Dr. Michael Carter.\n"
)

testScoringTranscript1 = (
    "Trainee: Thank you for calling Sunshine Pharmacy. My name is Sarah, and I’m here to assist you with your prescription needs. This call may be recorded for quality purposes. Before we proceed, may I have your full name, please?\n"
    "Customer: Hi, Sarah. This is Emily Johnson.\n"
    "Trainee: Thank you, Ms. Johnson. To ensure the privacy and security of your health information in accordance with HIPAA regulations, I need to verify your identity. Can you please provide your date of birth and the phone number associated with your pharmacy account?\n"
    "Customer: My date of birth is April 15, 1985, and my phone number is 555-123-4567.\n"
    "Trainee: Thank you. Let me verify that information. Your information matches our records. How may I assist you with your prescription today?\n"
    "Customer: I need to check the status of a prescription and see if I can get it refilled.\n"
    "Trainee: Thank you, Ms. Johnson. Let me look up that prescription. I’ve found your prescription for Lisinopril, 10 mg, prescribed by Dr. Michael Carter. It looks like you have one refill remaining, and the prescription is eligible for fulfillment. Would you like me to process the refill for you today?\n"
    "Customer: Yes, please. Can you tell me when it will be ready?\n"
    "Trainee: Certainly. I’m processing the refill now. It should be ready for pickup at Sunshine Pharmacy by 3\n"
    "Customer: I’d like delivery, please.\n"
    "Trainee: Great. Let me confirm your delivery address. Our records show your address as 123 Maple Street, Apartment 4B, Springfield, IL 62701. Is that correct?\n"
    "Customer: Yes, that’s correct.\n"
    "Trainee: Perfect. The medication will be delivered to that address by tomorrow afternoon. You’ll receive a confirmation call or text when it’s on its way. The cost for the Lisinopril refill is $15. Would you like to use the card on file ending in 1234, or would you prefer another payment method?\n"
    "Customer: The card on file is fine.\n"
    "Trainee: Thank you. I’ve processed the payment, and the refill order is confirmed. Before we conclude, I need to provide a few important reminders\n"
    "Customer: No, that’s all. Thank you, Sarah.\n"
    "Trainee: You’re very welcome, Ms. Johnson. Thank you for choosing Sunshine Pharmacy.\n"
    "Customer: You too. Goodbye."
)

testScoringTranscript2 = (
    "Trainee: Thank you for calling Sunshine Pharmacy. My name is Sarah, and I’m here to assist you with your prescription needs. This call may be recorded for quality purposes. Before we proceed, may I have your name, please?\n"
    "Customer: Hi, Sarah. This is Emily Johnson.\n"
    "Trainee: Thank you, Ms. Johnson. To ensure the privacy and security of your health information in accordance with HIPAA regulations, I need to verify your identity. Can you please provide your date of birth and the phone number associated with your pharmacy account?\n"
    "Customer: My date of birth is April 15, 1985, and my phone number is 555-123-4567.\n"
    "Trainee: Thank you. Let me verify that information. Your information matches our records. How may I assist you with your prescription today?\n"
    "Customer: I need to check the status of a prescription and see if I can get it refilled.\n"
    "Trainee: I’d be happy to help with that. Can you please provide the prescription number, or if you don’t have it, the name of the medication and the prescribing physician?\n"
    "Customer: I don’t have the prescription number, but the medication is Lisinopril, 10 mg, and it was prescribed by Dr. Michael Carter.\n"
    "Trainee: Thank you, Ms. Johnson. Let me look up that prescription. I’ve found your prescription for Lisinopril, 10 mg, prescribed by Dr. Michael Carter. It looks like you have one refill remaining, and the prescription is eligible for fulfillment. Would you like me to process the refill for you today?\n"
    "Customer: Yes, please. Can you tell me when it will be ready?\n"
    "Trainee: Certainly. I’m processing the refill now. It should be ready for pickup at Sunshine Pharmacy by 3\n"
    "Customer: I’d like delivery, please.\n"
    "Trainee: Great. Let me confirm your delivery address. Our records show your address as 123 Maple Street, Apartment 4B, Springfield, IL 62701. Is that correct?\n"
    "Customer: Yes, that’s correct.\n"
    "Trainee: Perfect. The medication will be delivered to that address by tomorrow afternoon. You’ll receive a confirmation call or text when it’s on its way. The cost for the Lisinopril refill is $15. Would you like to use the card on file ending in 1234, or would you prefer another payment method?\n"
    "Customer: The card on file is fine.\n"
    "Trainee: Thank you. I’ve processed the payment, and the refill order is confirmed. Before we conclude, I need to provide a few important reminders\n"
    "Customer: No, that’s all. Thank you, Sarah.\n"
    "Trainee: You’re very welcome, Ms. Johnson. Thank you for choosing Sunshine Pharmacy. Have a great day!\n"
    "Customer: You too. Goodbye."
)

testScoringTranscript3 = (
    "Trainee: Welcome to Sunshine Pharmacy. My name is Sarah, and I’m here to support you with any prescription-related concerns. This call might be recorded for quality assurance and training purposes. May I please begin by getting your full name?\n"
    "Customer: Hi Sarah, I’m Emily Johnson.\n"
    "Trainee: Thank you, Ms. Johnson. In line with HIPAA standards, I need to confirm your identity to protect your private health data. Could you share your date of birth and the phone number linked to your pharmacy account?\n"
    "Customer: My birthday is April 15, 1985, and my number is 555-123-4567.\n"
    "Trainee: Thanks for that. I’ll go ahead and verify the details. Everything matches our system. How can I help you with your prescription today?\n"
    "Customer: I want to check the status of a prescription and see if I’m able to refill it.\n"
    "Trainee: Absolutely, I can assist with that. Could you give me the prescription number, or if that’s not available, the name of the medication and the prescribing doctor?\n"
    "Customer: I don’t have the prescription number handy. It’s for Lisinopril, 10 mg, and the doctor is Dr. Michael Carter.\n"
    "Trainee: Appreciate it, Ms. Johnson. I’ll pull up that information. I’ve located your Lisinopril, 10 mg prescription from Dr. Michael Carter. You have one refill left, and it’s eligible to be filled. Shall I go ahead and process the refill now?\n"
    "Customer: Yes, please. When will it be ready?\n"
    "Trainee: Certainly. I'm processing it now. It should be available for pickup at Sunshine Pharmacy by 3 PM.\n"
    "Customer: I’d prefer it to be delivered.\n"
    "Trainee: No problem. Let me confirm your delivery details. We have 123 Maple Street, Apartment 4B, Springfield, IL 62701 listed. Is that still accurate?\n"
    "Customer: Yes, that’s the correct address.\n"
    "Trainee: Great. You’ll receive the medication at that address by tomorrow afternoon. A text or call will notify you once it’s on the way. The refill for Lisinopril is $15. Would you like to use the card ending in 1234 that we have on file, or would you prefer a different payment method?\n"
    "Customer: The card on file is fine.\n"
    "Trainee: Perfect. Your payment has been completed, and the refill order is now confirmed. Before wrapping up, I just need to share a couple of important notes.\n"
    "Customer: No, that’s everything. Thanks, Sarah.\n"
    "Trainee: My pleasure, Ms. Johnson. We appreciate you choosing Sunshine Pharmacy. Wishing you a wonderful day!\n"
    "Customer: You too. Bye."
)

testScoringTranscript4 = (
    "Trainee: Thank you for calling Sunshine Pharmacy. My name is Sarah, and I’m here to assist you with your prescription needs. This call may be recorded for quality purposes. Before we proceed, may I have your name, please?\n"
    "Customer: Hi, Sarah. This is Emily Johnson.\n"
    "Trainee: Thank you, Ms. Johnson. To ensure the privacy and security of your health information in accordance with HIPAA regulations, I need to verify your identity. Can you please provide your date of birth and the phone number associated with your pharmacy account?\n"
    "Customer: My date of birth is April 15, 1985, and my phone number is 555-123-4567.\n"
    "Trainee: Thank you. Let me verify that information. Your information matches our records. How may I assist you with your prescription today?\n"
    "Customer: I need to check the status of a prescription and see if I can get it refilled.\n"
    "Trainee: I’d be happy to help with that. Can you please provide the prescription number, or if you don’t have it, the name of the medication and the prescribing physician?\n"
    "Customer: I don’t have the prescription number, but the medication is Lisinopril, 10 mg, and it was prescribed by Dr. Michael Carter.\n"
    "Trainee: Thank you, Ms. Johnson. Let me look up that prescription. I’ve found your prescription for Lisinopril, 10 mg, prescribed by Dr. Michael Carter. It looks like you have one refill remaining, and the prescription is eligible for fulfillment. Would you like me to process the refill for you today?\n"
    "Customer: Yes, please. Can you tell me when it will be ready?\n"
    "Trainee: Certainly. I’m processing the refill now. It should be ready for pickup at Sunshine Pharmacy by 3\n"
    "Customer: I’d like delivery, please.\n"
    "Trainee: Great. Let me confirm your delivery address. Our records show your address as 123 Maple Street, Apartment 4B, Springfield, IL 62701. Is that correct?\n"
    "Customer: Yes, that’s correct.\n"
    "Trainee: Perfect. The medication will be delivered to that address by tomorrow afternoon. You’ll receive a confirmation call or text when it’s on its way. The cost for the Lisinopril refill is $15. Would you like to use the card on file ending in 1234, or would you prefer another payment method?\n"
    "Customer: The card on file is fine.\n"
    "Trainee: You’re very welcome, Ms. Johnson. Thank you for choosing Sunshine Pharmacy. Have a great day!\n"
    "Customer: You too. Goodbye."
)

testScoringTranscript5 = (
    "Trainee: Welcome to Sunshine Pharmacy. My name is Sarah, and I’m here to support you with any prescription-related concerns. This call might be recorded for quality assurance and training purposes. May I please begin by getting your full name?\n"
    "Customer: Hi Sarah, I’m Emily Johnson.\n"
    "Trainee: Thank you, Ms. Johnson. In line with HIPAA standards, I need to confirm your identity to protect your private health data. Could you share your date of birth and the phone number linked to your pharmacy account?\n"
    "Customer: My birthday is April 15, 1985, and my number is 555-123-4567.\n"
    "Trainee: Thanks for that. I’ll go ahead and verify the details. Everything matches our system. How can I help you with your prescription today?\n"
    "Customer: I want to check the status of a prescription and see if I’m able to refill it.\n"
    "Trainee: Absolutely, I can assist with that. Could you give me the prescription number, or if that’s not available, the name of the medication and the prescribing doctor?\n"
    "Customer: I don’t have the prescription number handy. It’s for Lisinopril, 10 mg, and the doctor is Dr. Michael Carter.\n"
    "Trainee: Appreciate it, Ms. Johnson. I’ll pull up that information. I’ve located your Lisinopril, 10 mg prescription from Dr. Michael Carter. You have one refill left, and it’s eligible to be filled. Shall I go ahead and process the refill now?\n"
    "Customer: Yes, please. When will it be ready?\n"
    "Trainee: Certainly. I'm processing it now. It should be available for pickup at Sunshine Pharmacy by 3 PM.\n"
    "Customer: I’d prefer it to be delivered.\n"
    "Trainee: No problem. Let me confirm your delivery details. We have 123 Maple Street, Apartment 4B, Springfield, IL 62701 listed. Is that still accurate?\n"
    "Customer: Yes, that’s the correct address.\n"
    "Trainee: Great. You’ll receive the medication at that address by tomorrow afternoon. A text or call will notify you once it’s on the way. The refill for Lisinopril is $15. Would you like to use the card ending in 1234 that we have on file, or would you prefer a different payment method?\n"
    "Customer: The card on file is fine.\n"
    "Trainee: My pleasure, Ms. Johnson. We appreciate you choosing Sunshine Pharmacy. Wishing you a wonderful day!\n"
    "Customer: You too. Bye."
)

testScoringTranscript6 = (
    "Trainee: Thank you for calling Sunshine Pharmacy. My name is Sarah, and I’m here to assist you with your prescription needs. This call may be recorded for quality purposes. Before we proceed, may I have your name, please?\n"
    "Customer: Hi, Sarah. This is Emily Johnson.\n"
    "Trainee: Thank you, Ms. Johnson. To ensure the privacy and security of your health information in accordance with HIPAA regulations, I need to verify your identity. Can you please provide your date of birth and the phone number associated with your pharmacy account?\n"
    "Customer: My date of birth is April 15, 1985, and my phone number is 555-123-4567.\n"
    "Trainee: Thank you. Let me verify that information. Your information matches our records. How may I assist you with your prescription today?\n"
    "Customer: I need to check the status of a prescription and see if I can get it refilled.\n"
    "Trainee: I’d be happy to help with that. Can you please provide the prescription number, or if you don’t have it, the name of the medication and the prescribing physician?\n"
    "Customer: I don’t have the prescription number, but the medication is Lisinopril, 10 mg, and it was prescribed by Dr. Michael Carter.\n"
    "Trainee: Thank you, Ms. Johnson. Let me look up that prescription. I’ve found your prescription for Lisinopril, 10 mg, prescribed by Dr. Michael Carter. It looks like you have one refill remaining, and the prescription is eligible for fulfillment. Would you like me to process the refill for you today?\n"
    "Customer: Yes, please. Can you tell me when it will be ready?\n"
)

SYSTEM_PROMPT_KEYWORD_SCORING = """
You are an AI evaluator tasked with assessing how closely a trainee's responses follow a predefined customer service script.

You will be provided two inputs:

1. Original Script:
- A list of lines from an ideal customer service interaction.
- Each line contains:
  - `role`: either "Trainee" or "Customer"
  - `script_sentence`: the expected dialogue for that speaker
  - `keywords`: a list of keywords relevant to that sentence (only for Trainee lines; empty or omitted for Customer lines)

2. Transcript:
- A string representing the real conversation between a Trainee and a Customer.
- Each line begins with either "Trainee:" or "Customer:" followed by the spoken content.

Important Rules:

- You must process each line from the 'Original Script' one by one in order.
- For **every** 'Original Script' line, you must create **exactly one** corresponding entry in the output, **even if the transcript does not contain a match**.
- The final output must always contain the **same number of entries** as the 'Original Script', and the output must **strictly preserve the order** of the 'Original Script'.
- Do NOT iterate over the transcript. Only iterate over the 'Original Script'.

- For each index `i` in the Original Script list:
  - If the transcript has a line at index `i`, extract that line (split by line breaks).
    - If the line starts with the correct speaker label ("Trainee:" or "Customer:"), use the content after the label as `actual_sentence`.
    - If it does not match the expected speaker, set `actual_sentence` to null.
  - If the transcript does **not** contain a line at index `i`, set `actual_sentence` to null.

STRICT INDEXING RULE:
- You must not look ahead or behind in the transcript.
- Under no circumstances should `actual_sentence` be populated from a different transcript index than the current script index.
- If the transcript has fewer lines than the original script, the missing entries must result in `actual_sentence: null`.

STRICT MATCHING RULE (MANDATORY):
You are strictly matching literal substrings. This means:
- No semantic or intent-based interpretation.
- No fuzzy, approximate, or partial matching.
- Do not expand abbreviations or paraphrase.
- A substring match means the exact sequence of characters appears in the text, without any casing.
- Do NOT rely on the meaning of the sentence.
- Do NOT accept close-enough words, paraphrases, or synonyms.
- A keyword must appear **exactly as-is** (ignoring case), or it is considered missing.

Examples:
  Match: "dog" in "The dog barked." → Yes.
  Match: "dog" in "The dogs barked." → No (extra 's').
  Match: "Dog" in "The dog barked." → No (case mismatch).
  Match: "fast" in "He was quick." → No (synonym, not a literal match).

Instructions:

For each 'Original Script' entry:

- If `role` is **Customer**:
  - `script_sentence`: should match the 'Original Script' entry's sentence exactly.
  - `actual_sentence`: should be the line at the same index in the transcript if present and it begins with "Customer:"; otherwise, set to null.
  - `keyword_analysis`: always set to null.

- If `role` is **Trainee**:
  - `actual_sentence`: should be the line at the same index in the transcript if present and it begins with "Trainee:"; otherwise, set to null.
  - `script_sentence`: always copy the sentence from the original script.
  - `keyword_analysis`:
    - If the original script line contains keywords list which is not empty:
      - If actual_sentence is not null:
        - For each keyword in the keywords list:
          - Convert both the keyword and the actual_sentence to lowercase.
          - Perform a **STRICT CASE-INSENSITIVE LITERAL SUBSTRING MATCH WITH ACTUAL SENTENCE VALUE**:
            - YOU MUST Adhere to STRICT MATCHING RULE defined above even if scripted_sentence doesnot match exactly with actual_sentence. DO NOT use any semantic or intent-based interpretation for each keyword to check if its present in actual sentence.
            - A keyword is considered matched **only if** the **entire keyword phrase** appears **as-is** as a **contiguous sequence of characters** in the `actual_sentence` (ignoring case).
            - A keyword must appear **exactly as-is** (ignoring case), or it is considered missing.
        - Return:
          - `total_keywords`: number of keywords in the original script line.
          - `missing_keywords`: number of keywords that were not matched in the actual_sentence.
          - `missing_keywords_list`: list of the missing keywords.
      - If actual_sentence is null:
        - All keywords are considered missing.
        - Return:
          - `total_keywords`: keyword count from script.
          - `missing_keywords`: same value as above.
          - `missing_keywords_list`: full keyword list.
    - If the keyword list is empty:
      - Return `keyword_analysis` as an empty object: {}

STRICT RULE - Before returning response, once agin verify if in each of the line with role as Trainee, are the values in missing keywords list really missing from the actual_sentence of that object by checking if it appears in actual_sentence. so if you see keywords appears and it wrongly idenitified as missing then update the keyword_analysis object accordingly.
Strict Rule:
Final Output Format:
Strict Rule: - Must be a raw JSON array.
Strict Rule: - Each object in the array must include:
  - `role`
  - `script_sentence`
  - `actual_sentence`
  - `keyword_analysis`
Strict Rule: - Do NOT include markdown, backticks, or extra commentary before or after text.
Strict Rule: - The output must contain exactly the same number of items as the original script.
Strict Rule: - Maintain the exact order of the original script.

Example: Handling Missing Transcript Line

Original Script:
[
  {
    "role": "Trainee",
    "script_sentence": "Before we finish, I need to confirm your insurance details.",
    "keywords": ["insurance details"]
  },
  {
    "role": "Customer",
    "script_sentence": "No problem.",
    "keywords": []
  }
]

Transcript (only 1 line):
Trainee: Before we finish, I need to confirm your insurance details.

Expected Output:
[
  {
    "role": "Trainee",
    "script_sentence": "Before we finish, I need to confirm your insurance details.",
    "actual_sentence": "Before we finish, I need to confirm your insurance details.",
    "keyword_analysis": {
      "total_keywords": 1,
      "missing_keywords": 0,
      "missing_keywords_list": []
    }
  },
  {
    "role": "Customer",
    "script_sentence": "No problem.",
    "actual_sentence": null,
    "keyword_analysis": null
  }
]
"""

SYSTEM_MESSAGE_CONTEXT_ACCURACY = (
    "You are an expert customer service evaluator. Your task is to assess the contextual accuracy of each trainee's response in a customer service call by comparing the **scripted conversation** (expected) with the **actual transcript** (real interaction).\n\n"
    "Instructions:\n\n"
    "1. You will be given two inputs:\n"
    "   - `script`: the ideal training script for the trainee\n"
    "   - `transcript`: the actual conversation that took place\n\n"
    "2. Both `script` and `transcript` are structured as alternating lines from \"Trainee:\" and \"Customer:\", formatted as a single string with newline separators.\n\n"
    "3. STRICT RULE TO FOLLOW - You must evaluate **each line in the ORIGINAL SCRIPT** in the order it appears. For every line in the ORIGINAL SCRIPT at index `i`:\n"
    "   - Retrieve the **line at the same index `i` from the TRANSCRIPT**, if it exists.\n"
    "     - If it exists, assign it as the `actual_text`.\n"
    "     - If it does **not** exist (i.e., the transcript has fewer lines), set `actual_text` to `null`.\n"
    "     - **Do not attempt any semantic or role-based matching. Do not search ahead or behind. Only match by the exact index.**\n\n"
    "   - For `Trainee:` lines in the script, when a corresponding `actual_text` exists:\n"
    "     - Extract the `scripted_text` from the script.\n"
    "     - Use the matched `actual_text`.\n"
    "     - Identify the `scripted_context`: what the trainee was meant to achieve.\n"
    "     - Identify the `actual_context`: what was actually said.\n"
    "     - Write a `summary_evaluation` comparing intention vs. execution.\n"
    "     - Assign a `contextual_accuracy` score from 0 to 100.\n"
    "   - If no `actual_text` exists, all fields except `role` and `scripted_text` should be `null`.\n\n"
    "   - For `Customer:` lines, always return all fields except `role` and `scripted_text` as `null`, regardless of whether the transcript has a line at that position.\n\n"
    "4. STRICT RULE - The final output must be a JSON array with the **same number and order of lines as the ORIGINAL SCRIPT**. If the transcript is shorter, return `null` for the missing values. Do not rearrange, skip, or infer any content.\n\n"
    "5. STRICT RULE — Return the output in **pure JSON format only**, without any extra commentary, explanations, or markdown formatting before or after.\n"
    "Example 1:\n\n"
    "Sample Input:\n\n"
    "ORIGINAL SCRIPT: \n"
    "\"Trainee\": Thank you for calling Sunshine Pharmacy. My name is Sarah, and I’m here to assist you with your prescription needs. This call may be recorded for quality purposes. Before we proceed, may I have your name, please?\n"
    "\"Customer\": Hi, Sarah. This is Emily Johnson.\n"
    "\"Trainee\": Thank you, Ms. Johnson. To ensure the privacy and security of your health information in accordance with HIPAA regulations, I need to verify your identity. Can you please provide your date of birth and the phone number associated with your pharmacy account?\n\n"
    "TRANSCRIPT:\n"
    "\"Trainee\": Sunshine Pharmacy, Sarah speaking. Who’s this?\n"
    "\"Customer\": Hi, I’m Emily.\n"
    "\"Trainee\": I need to verify your identity. Can you give me your birth date and phone number?\n\n"
    "REQUIRED OUTPUT FORMAT:\n"
    "[\n"
    "  {\n"
    "    \"role\": \"Trainee\",\n"
    "    \"scripted_text\": \"Thank you for calling Sunshine Pharmacy. My name is Sarah, and I’m here to assist you with your prescription needs. This call may be recorded for quality purposes. Before we proceed, may I have your name, please?\",\n"
    "    \"actual_text\": \"Sunshine Pharmacy, Sarah speaking. Who’s this?\",\n"
    "    \"scripted_context\": \"Politely greet the caller, introduce yourself, state purpose, mention call recording for compliance, and request customer’s name.\",\n"
    "    \"actual_context\": \"Greets and identifies the pharmacy and self but omits purpose, compliance notice, and uses an informal prompt to ask for the customer's name.\",\n"
    "    \"summary_evaluation\": \"The trainee covers basic greeting but misses essential compliance and professionalism markers. Tone is more casual than appropriate. Partial match.\",\n"
    "    \"contextual_accuracy\": 62\n"
    "  },\n"
    "  {\n"
    "    \"role\": \"Customer\",\n"
    "    \"scripted_text\": Hi, Sarah. This is Emily Johnson.,\n"
    "    \"actual_text\": \"Hi, I’m Emily.\",\n"
    "    \"scripted_context\": null,\n"
    "    \"actual_context\": null,\n"
    "    \"summary_evaluation\": null,\n"
    "    \"contextual_accuracy\": null\n"
    "  },\n"
    "  {\n"
    "    \"role\": \"Trainee\",\n"
    "    \"scripted_text\": \"Thank you, Ms. Johnson. To ensure the privacy and security of your health information in accordance with HIPAA regulations, I need to verify your identity. Can you please provide your date of birth and the phone number associated with your pharmacy account?\",\n"
    "    \"actual_text\": \"I need to verify your identity. Can you give me your birth date and phone number?\",\n"
    "    \"scripted_context\": \"Confirm customer's identity by referencing HIPAA compliance and requesting DOB and phone number for verification.\",\n"
    "    \"actual_context\": \"Requests DOB and phone number for identity verification without referencing HIPAA or privacy compliance.\",\n"
    "    \"summary_evaluation\": \"The core verification is done, but lacks legal/compliance framing, which is crucial in the script. Adequate but missing policy reinforcement.\",\n"
    "    \"contextual_accuracy\": 78\n"
    "  }\n"
    "]\n"
    "Example 2 where script length doesn't match with transcript length:\n\n"
    "Sample Input:\n\n"
    "ORIGINAL SCRIPT:\n"
    "\"Trainee\": Thank you for calling Sunshine Pharmacy. My name is Sarah, and I’m here to assist you with your prescription needs. This call may be recorded for quality purposes. Before we proceed, may I have your name, please?\n"
    "\"Customer\": Hi, Sarah. This is Emily Johnson.\n"
    "\"Trainee\": Thank you, Ms. Johnson. To ensure the privacy and security of your health information in accordance with HIPAA regulations, I need to verify your identity. Can you please provide your date of birth and the phone number associated with your pharmacy account?\n"
    "\"Customer\": My date of birth is April 15, 1985, and my phone number is 555-123-4567.\n"
    "TRANSCRIPT:\n"
    "\"Trainee\": Thank you for calling Sunshine Pharmacy. My name is Sarah.\n"
    "\"Customer\": Hello, this is Emily.\n\n"
    "EXPECTED OUTPUT:\n"
    "[\n"
    "  {\n"
    "    \"role\": \"Trainee\",\n"
    "    \"scripted_text\": Thank you for calling Sunshine Pharmacy. My name is Sarah, and I’m here to assist you with your prescription needs. This call may be recorded for quality purposes. Before we proceed, may I have your name, please?\n"
    "    \"actual_text\": \"Thank you for calling Sunshine Pharmacy. My name is Sarah.\",\n"
    "    \"scripted_context\": \"Politely greet the caller, introduce yourself, state purpose, mention call recording for compliance, and request customer’s name.\",\n"
    "    \"actual_context\": \"Greets and introduces self but omits purpose, compliance recording notice, and name request.\",\n"
    "    \"summary_evaluation\": \"The greeting is partial. Missing compliance info and clarity about intent. Needs better alignment with policy.\",\n"
    "    \"contextual_accuracy\": 60\n"
    "  },\n"
    "  {\n"
    "    \"role\": \"Customer\",\n"
    "    \"scripted_text\": Hi, Sarah. This is Emily Johnson.,\n"
    "    \"actual_text\": \"Hello, this is Emily.\",\n"
    "    \"scripted_context\": null,\n"
    "    \"actual_context\": null,\n"
    "    \"summary_evaluation\": null,\n"
    "    \"contextual_accuracy\": null\n"
    "  },\n"
    "  {\n"
    "    \"role\": \"Trainee\",\n"
    "    \"scripted_text\": \"Thank you, Ms. Johnson. To ensure the privacy and security of your health information in accordance with HIPAA regulations, I need to verify your identity. Can you please provide your date of birth and the phone number associated with your pharmacy account?\",\n"
    "    \"actual_text\": null,\n"
    "    \"scripted_context\": \"Thank the customer, explain the need for identity verification in compliance with HIPAA regulations, and request the customer’s date of birth and phone number.\",\n"
    "    \"actual_context\": null,\n"
    "    \"summary_evaluation\": null,\n"
    "    \"contextual_accuracy\": null\n"
    "  },\n"
    "  {\n"
    "    \"role\": \"Customer\",\n"
    "    \"scripted_text\": \"My date of birth is April 15, 1985, and my phone number is 555-123-4567.\",\n"
    "    \"actual_text\": null,\n"
    "    \"scripted_context\": null,\n"
    "    \"actual_context\": null,\n"
    "    \"summary_evaluation\": null,\n"
    "    \"contextual_accuracy\": null\n"
    "  }\n"
    "]"
)

SYSTEM_MESSAGE_BEHAVIOURAL_SCORING = """
You are an expert conversation evaluator.

You will receive two inputs:
1. Original Script: This is the ideal version of a conversation between a Trainee and a Customer.
2. Actual Script: This is the actual conversation that took place between the Trainee and the Customer.

Both scripts are in plain text format and each line is separated by a "\\n". Each line begins with the role of the speaker, either "Trainee:" or "Customer:".

Your task is to evaluate only the Trainee’s lines from the Actual Script against the Original Script and calculate scores for three key performance metrics:

Confidence Score (0–100)
Definition: Confidence measures the agent's ability to convey assurance and competence. Factors include:
- Accurate and consistent information delivery
- Handling objections or concerns with assurance
- Professional tone
- Clear and effective problem-solving guidance

Step 1: Analyze the Original Script and generate the confidence evaluation summary that is present in original script.
Step 2: Analyze the Actual Script’s Trainee lines for signs of confidence and generate the confidence evaluation summary for actual script.
Step 3: Compare the Actual Script confidence evaluation summary with the Original Script confidence evaluation summary and score based on how well the Actual Trainee has shown confidence in his actual script with respect to the confidence evaluation summary present in original script.

Concentration Score (0–100)
Definition: Concentration measures the agent's focus and clarity. Factors include:
- Response accuracy
- Adherence to protocol
- Logical flow and structured communication
- Minimal repetition and distractions

Step 1: Extract what “concentration” looks like from the Original Script.
Step 2: Check for any lack of focus, protocol deviation, or unnecessary repetition in the Actual Script.
Step 3: Compare and assign a score based on clarity, focus, and relevance.

Energy Score (0–100)
Definition: Energy measures enthusiasm and engagement. Factors include:
- Upbeat and positive tone
- Promptness and quick response
- Active engagement and good pacing

Step 1: Identify ideal expressions of energy in the Original Script.
Step 2: Look for tone, promptness, and engagement levels in the Actual Script.
Step 3: Compare and score based on liveliness, attentiveness, and pace.

STRICT RULE - Return the output strictly in the following JSON object as your response. Do NOT include any explanations, before or after text to the JSON Object.

{
  "confidence_score": {
    "overall_score": /* value between 0-100 */,
    "evaluation": "/* brief summary of confidence evaluation highlighting the strengths, what he has done well and areas for improvement */"
  },
  "concentration_score": {
    "overall_score": /* value between 0-100 */,
    "evaluation": "/* brief summary of concentration evaluation highlighting the strengths, what he has done well and areas for improvement */"
  },
  "energy_score": {
    "overall_score": /* value between 0-100 */,
    "evaluation": "/* brief summary of energy evaluation highlighting the strengths, what he has done well and areas for improvement */"
  }
}
STRICT RULE - Analyze both scripts before scoring and ensure that each justification clearly reflects the comparison against the ideal script.
"""

